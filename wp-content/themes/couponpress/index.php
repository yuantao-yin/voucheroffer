<?php

/***************** DO NOT EDIT THIS FILE *************************
******************************************************************

INFORMATION:
------------

This is a core theme file, you should not need to edit 
this file directly. Code changes maybe lost during updates.

LAST UPDATED: June 26th 2011
EDITED BY: MARK FAIL
------------------------------------------------------------------

******************************************************************/

global $PPT,$ThemeDesign, $PPTDesign, $user_ID, $userdata; get_currentuserinfo();
  
// CHECK FOR MOBILE DEVICE
if(get_option('ppt_mobile') == 1 && $PPTMobile->_check() != false){
	$PPTMobile->start();die();
}




if(is_home() && !isset($_GET['s']) && !isset($_GET['search-class']) ){

	/* ================ LOAD TEMPLATE FILE =========================== */
	
	$DHOME = get_option("display_default_homepage");
	
	$THEMEN = get_option('theme'); //if(isset($_SESSION['dd'])){ $THEMEN = $_SESSION['dd']; }

	if(file_exists(str_replace("functions/","",THEME_PATH)."/themes/".$THEMEN."/_homepage.php") && $DHOME != 1 ){
		
		include(str_replace("functions/","",THEME_PATH)."/themes/".$THEMEN.'/_homepage.php');
		
	}else{ 
	
		include("template_".strtolower(PREMIUMPRESS_SYSTEM)."/_homepage.php");
	
	}
	 

}else{

	$GLOBALS['GALLERYPAGE'] = 1;

	/* ================== PREMIUM PRESSS SEARCH PARAMERTERS =================== */	
 
	$query_string 	= $PPT->BuildSearchString($query_string);	
	 
 
	if(strpos($query_string, "taxonomy=article") === false && strpos($query_string, "article=") === false ) { 
	if(strpos($query_string, "taxonomy=faq") === false && strpos($query_string, "faq=") === false) {  
	
	if(isset($GLOBALS['premiumpress']['theme_folder']) && $GLOBALS['premiumpress']['theme_folder'] == "auctionpress"){ $query_string .= "&meta_key=bid_status&meta_value=open"; }
	
	}else{  $query_string = str_replace("&post_type=post","",str_replace("&orderby=meta_value","",str_replace("&meta_key=featured","",str_replace("&meta_key=price","",$query_string))));  $GLOBALS['setflag_faq']=1;  } 
	}else{  $query_string = str_replace("&post_type=post","",str_replace("&orderby=meta_value","",str_replace("&meta_key=featured","",str_replace("&meta_key=price","",$query_string)))); $GLOBALS['setflag_article']=1; } // STRIPS TYPE POST FOR ARTICLES
	
	
	
	if(isset($_GET['cct'])){ $catC = "&cat=".$_GET['cct']; }else{ $catC = ""; }

		if(isset($_GET['quick'])){
		
			switch($_GET['quick']){
			
			case "new": 		{ $query_string = "&orderby=modified&order=asc&s=&post_type=post"; } break;
			case "featured": 	{ $query_string = "&meta_key=featured&meta_value=yes&orderby=meta_value&order=desc&post_type=post"; } break;
			case "active": 		{ $query_string = "&meta_key=bid_count&orderby=meta_value&order=meta_value_num&post_type=post"; } break;				
			case "ending": 		{ $query_string = "&meta_key=expires&orderby=meta_value_num&order=asc&post_type=post"; } break;		
			case "discount": 	{ $query_string = "&meta_key=old_price&orderby=meta_value&order=meta_value_num&post_type=post"; } break;
			
			case "500": 		{ $query_string = "&meta_key=price_current&orderby=meta_value&order=meta_value_num&meta_compare=<=&meta_value=500a&post_type=post"; } break;					
			case "2000": 		{ $query_string = "&meta_key=price_current&orderby=meta_value&order=meta_value_num&meta_compare=<=&meta_value=2000a&post_type=post"; } break;	
			case "5000": 		{ $query_string = "&meta_key=price_current&orderby=meta_value&order=meta_value_num&meta_compare=<=&meta_value=5000a&post_type=post"; } break;	
			case "10000": 		{ $query_string = "&meta_key=price_current&orderby=meta_value&order=meta_value_num&meta_compare=>=&meta_value=10000a&post_type=post"; } break;
			
			// HOUSES LESS THAN 200k
			case "100k": 		{ $query_string = "&meta_key=price&orderby=meta_value&order=meta_value_num&meta_compare=<=&meta_value=100k&post_type=post".$catC; } break;	
			case "200k": 		{ $query_string = "&meta_key=price&orderby=meta_value&order=meta_value_num&meta_compare=&meta_value=200k&post_type=post".$catC; } break;
			case "300k": 		{ $query_string = "&meta_key=price&orderby=meta_value&order=meta_value_num&meta_compare=&meta_value=300k&post_type=post".$catC; } break;			
			case "400k": 		{ $query_string = "&meta_key=price&orderby=meta_value&order=meta_value_num&meta_compare==&meta_value=400k&post_type=post".$catC; } break;			
			case "500k": 		{ $query_string = "&meta_key=price&orderby=meta_value&order=meta_value_num&meta_compare==&meta_value=500k&post_type=post".$catC; } break;			
			case "600k": 		{ $query_string = "&meta_key=price&orderby=meta_value&order=meta_value_num&meta_compare==&meta_value=600k&post_type=post".$catC; } break;
			case "700k": 		{ $query_string = "&meta_key=price&orderby=meta_value&order=meta_value_num&meta_compare==&meta_value=700k&post_type=post".$catC; } break;					
			case "800k": 		{ $query_string = "&meta_key=price&orderby=meta_value&order=meta_value_num&meta_compare==&meta_value=800k&post_type=post".$catC; } break;			
			case "800k": 		{ $query_string = "&meta_key=price&orderby=meta_value&order=meta_value_num&meta_compare==&meta_value=900k&post_type=post".$catC; } break;	
			case "700ka": 		{ $query_string = "&meta_key=price&orderby=meta_value&order=meta_value_num&meta_compare==&meta_value=700ka&post_type=post".$catC; } break;	
			
			// SP
			case "100": 		{ $query_string = "&meta_key=price&orderby=meta_value&order=meta_value_num&meta_compare=<=&meta_value=100a&post_type=post"; } break;	
			case "between": 	{ $query_string = "&meta_key=price&orderby=meta_value&order=meta_value_num&meta_compare==&meta_value=xxxx&post_type=post".$catC; } break;
									
			}
		
		}
		
	//if(strtolower(PREMIUMPRESS_SYSTEM) != "auctionpress"){ $query_string = str_replace("price_current","price",str_replace("bid_count","hits",$query_string)); }	
 	if(isset($GLOBALS['limitSearch']) && is_numeric($GLOBALS['limitSearch']) ){ $query_string .= "&posts_per_page=".$GLOBALS['limitSearch']; }
 	$paged = (get_query_var('paged')) ? get_query_var('paged') : 1;
	$posts = query_posts($query_string."&paged=".$paged);
	$GLOBALS['query_data'] 		= $posts;
	$GLOBALS['query_string'] 	= $query_string;
 
 	// SET VALUE ONLY IF ITS A TAG SEARCH
	if(strpos($GLOBALS['query_string'], "tag=") !== false ) { 
	 $GLOBALS['tag_search'] = true;
	}
	 
	// Load the total number of search results found
	//if(isset($post->ID) && $post->ID != "" && !isset($_GET['s']) ){
	//	$allsearch = &new WP_Query($query_string."&showposts=-1");
	//}else{
		$allsearch = &new WP_Query($query_string);
	//}

	

	$GLOBALS['query_total'] = $allsearch;	
	$GLOBALS['query_total_num'] = $allsearch->post_count;	
	
 
	
	//odd but works
	if($allsearch->found_posts > $allsearch->post_count){
		$GLOBALS['query_total_num'] = $allsearch->found_posts;	
	} 
	//print $GLOBALS['query_total_num']."<br>";
 
	/* ================ LOAD TEMPLATE FILE =========================== */
		
	if(file_exists(str_replace("functions/","",THEME_PATH)."/themes/".get_option('theme')."/_gallerypage.php")){
		
		include(str_replace("functions/","",THEME_PATH)."/themes/".get_option('theme').'/_gallerypage.php');
		
	}else{ 
	 
		include("template_".strtolower(PREMIUMPRESS_SYSTEM)."/_gallerypage.php");
	
	}

}
 
?>